--- /dev/null
+++ llvm-toolchain-4.0-4.0.1/cmake/config.guess.hack
@@ -0,0 +1,2 @@
+#!/bin/bash -e
+$(dirname "$0")/config.guess | sed -r s/arm[a-zA-Z0-9]*/armv6/
--- llvm-toolchain-4.0-4.0.1.orig/cmake/modules/GetHostTriple.cmake
+++ llvm-toolchain-4.0-4.0.1/cmake/modules/GetHostTriple.cmake
@@ -15,7 +15,7 @@ function( get_host_triple var )
       set( value "i686-pc-mingw32" )
     endif()
   else( MSVC )
-    set(config_guess ${LLVM_MAIN_SRC_DIR}/cmake/config.guess)
+    set(config_guess ${LLVM_MAIN_SRC_DIR}/cmake/config.guess.hack)
     execute_process(COMMAND sh ${config_guess}
       RESULT_VARIABLE TT_RV
       OUTPUT_VARIABLE TT_OUT
--- llvm-toolchain-4.0-4.0.1.orig/compiler-rt/cmake/base-config-ix.cmake
+++ llvm-toolchain-4.0-4.0.1/compiler-rt/cmake/base-config-ix.cmake
@@ -170,8 +170,8 @@ macro(test_targets)
       if(WIN32)
         test_target_arch(arm "" "" "")
       else()
-        test_target_arch(arm "" "-march=armv7-a" "-mfloat-abi=soft")
-        test_target_arch(armhf "" "-march=armv7-a" "-mfloat-abi=hard")
+        test_target_arch(arm "" "" "-mfloat-abi=soft")
+        test_target_arch(armhf "" "" "-mfloat-abi=hard")
       endif()
     elseif("${COMPILER_RT_DEFAULT_TARGET_ARCH}" MATCHES "aarch32")
       test_target_arch(aarch32 "" "-march=armv8-a")
